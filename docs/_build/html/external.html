

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extend Nmon with external data &mdash; TA-nmon 1.3.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="author" title="About these documents"
              href="about.html"/>
    <link rel="top" title="TA-nmon 1.3.0 documentation" href="index.html"/>
        <link rel="next" title="Configure your options with nmon.conf" href="nmon_config.html"/>
        <link rel="prev" title="Upgrade" href="upgrade.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> TA-nmon
          

          
          </a>

          
            
            
              <div class="version">
                1.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">About the TA-nmon, technical addon for Nmon Performance app for Splunk</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasenotes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="knownissues.html">Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="openissue.html">Issues and enhancement requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="os_compatibility.html">Operating Systems compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_overview.html">Introduction to Nmon processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="footprint.html">Benchmarks &amp; TA-nmon foot print</a></li>
<li class="toctree-l1"><a class="reference internal" href="binaries.html">Scripts and Binaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Pre-requisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment_matrix.html">Deployment Matrix</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_processing.html">Processing workflow in action</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade.html">Upgrade</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Extend Nmon with external data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-does-it-work">How does it work ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ok-got-it-how-do-i-add-mine">Ok got it, how do I add mine ?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="nmon_config.html">Configure your options with nmon.conf</a></li>
<li class="toctree-l1"><a class="reference internal" href="json_indexing.html">JSON indexing versus legacy CSV</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="troubleshoot.html">Troubleshoot</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">TA-nmon</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Extend Nmon with external data</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/external.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="extend-nmon-with-external-data">
<h1>Extend Nmon with external data<a class="headerlink" href="#extend-nmon-with-external-data" title="Permalink to this headline">¶</a></h1>
<p><strong>Nmon external compatibility:</strong></p>
<ul class="simple">
<li>AIX 7.2</li>
<li>Linux</li>
<li>Solaris</li>
</ul>
<p><em>for some unknown reasons, the nmon external feature does not properly work in AIX 6.1/7.1, the collection stops after an arbitrary amount of time, this issue is under investigation*</em></p>
<p>Since the release 1.3.x of the TA-nmon, you can extend very easily the context of the nmon data using the nmon external scripts.</p>
<p>Integrating external data is an integrated feature in nmon binaries (for AIX, Linux and Solaris), and it has been integrated within the TA-nmon such that it is
even much easier to integrate anything that matters for you.</p>
<p><strong>The data can be retrieved from:</strong></p>
<ul class="simple">
<li>Any command available to the operating system</li>
<li>Script of any kind that can be called within a shell script: other shell script, Python, Perl...</li>
</ul>
<p>Basically anything you can retrieve from your systems!</p>
<div class="section" id="how-does-it-work">
<h2>How does it work ?<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">¶</a></h2>
<p><strong>Very simple, we start with 2 simple shell scripts involved:</strong></p>
<ul class="simple">
<li>bin/nmon_external_cmd/nmon_external_start.sh</li>
<li>bin/nmon_external_cmd/nmon_external_snap.sh</li>
</ul>
<p><strong>Both scripts are being called automatically by nmon binaries, using the global environment variables (set by bin/nmon_helper.sh):</strong></p>
<ul class="simple">
<li>NMON_START which equals to the full path of the nmon_external_start.sh script</li>
<li>NMON_SNAP which equals to the full path of the nmon_external_snap.sh script</li>
</ul>
<p><em>An additional variable set by bin/nmon_helper.sh defines the fifo file path were to write the data (used by bin/nmon_external_cmd/</em>.sh script)*</p>
<img alt="img/nmon_external_workflow1.png" class="align-center" src="_images/nmon_external_workflow1.png" />
<p><strong>Then, nmon parsers will automatically load the list of nmon sections to be parsed (the &#8220;type&#8221; field in Splunk) defined in:</strong></p>
<ul class="simple">
<li>default/nmonparser_config.json (for the default configuration)</li>
<li>local/nmonparser_config.json (for upgrade resilient customization)</li>
</ul>
<img alt="img/nmon_external_workflow2.png" class="align-center" src="_images/nmon_external_workflow2.png" />
</div>
<div class="section" id="ok-got-it-how-do-i-add-mine">
<h2>Ok got it, how do I add mine ?<a class="headerlink" href="#ok-got-it-how-do-i-add-mine" title="Permalink to this headline">¶</a></h2>
<p><strong>Right, very simple, let&#8217;s take the example of the uptime command output:</strong></p>
<p>Running the &#8220;uptime&#8221; command outputs various interesting information: server uptime, number of Unix users connected, system load for last minute, 5 minutes, 15 minutes:</p>
<div class="highlight-python"><div class="highlight"><pre>19:08:45 up 11:00,  1 user,  load average: 0.13, 0.22, 0.19
</pre></div>
</div>
<p><strong>STEP 1: header definition</strong></p>
<p>Within the &#8220;bin/nmon_external_start.sh&#8221; script, we add:</p>
<div class="highlight-python"><div class="highlight"><pre># uptime information
echo &quot;UPTIME,Server Uptime and load,uptime_stdout&quot; &gt;&gt;$NMON_EXTERNAL_DIR/nmon.fifo
</pre></div>
</div>
<p><em>Explanations:</em></p>
<ul class="simple">
<li>The first field , in our &#8220;UPTIME&#8221;, with the nmon section name, indexed in the &#8220;type&#8221; field in Splunk, and to be added in the nmonparser_config.json</li>
<li>The second field is a descriptive field</li>
<li>All the other fields are the data fields</li>
<li>All fields must be comma separated</li>
</ul>
<p><strong>STEP 2: data generation</strong></p>
<p>In the step 2, we modify the &#8220;bin/nmon_external_snap.sh&#8221; script to add:</p>
<div class="highlight-python"><div class="highlight"><pre># Uptime information (uptime command output)
echo &quot;UPTIME,$1,\&quot;`uptime | sed &#39;s/^\s//g&#39; | sed &#39;s/,/;/g&#39;`\&quot;&quot; &gt;&gt;$NMON_EXTERNAL_DIR/nmon.fifo
</pre></div>
</div>
<p><em>Explanations:</em></p>
<ul class="simple">
<li>The first field refers to the nmon section we previously defined in &#8220;bin/nmon_external_snap.sh&#8221;</li>
<li>The second field &#8220;$1&#8221; refers to the value of the nmon time stamp (Txxxx), and will be defined automatically by nmon</li>
<li>The first field defines here our data field (we could have more than one!)</li>
<li>In the uptime example, our command produces commas, to avoid any trouble we replace any comma by colons, and we protect the field by double quotes</li>
</ul>
<p><strong>STEP 3: add the monitor in nmonparser_config.json</strong></p>
<p>The uptime example is integrated in the TA-nmon, its definition can be found in &#8220;default/nmonparser_config.json&#8221;.</p>
<p>However, if you add your own monitors, please create a &#8220;local/nmonparser_config.json&#8221; and add your monitors declaration.</p>
<p><strong>There is 2 types of declaration to be used:</strong></p>
<ul class="simple">
<li>&#8220;nmon_external:&#8221; This is a simple literal parsing of the data, the output will be indexed the same way it has been produced</li>
<li>&#8220;nmon_external_transposed&#8221;: This is a different case where data will be transposed, it has to be used when you have a notion of &#8220;device/value&#8221;</li>
</ul>
<p><em>Example:</em></p>
<p>In our example, we just need to have:</p>
<div class="highlight-python"><div class="highlight"><pre>&quot;nmon_external&quot;:[&quot;UPTIME&quot;],
</pre></div>
</div>
<p><em>More explanations about the &#8220;nmon_external_transposed&#8221;:</em></p>
<p>Here is an example of nmon data that the parser automatically transpose:</p>
<div class="highlight-python"><div class="highlight"><pre>DISKXFER,Disk transfers per second sys-86400,sr0,sda,sda1,sda2,sdb
DISKXFER,T0001,0.5,0.7,0.2,0.5,0.0
DISKXFER,T0002,0.0,3.1,0.0,3.1,0.0
DISKXFER,T0003,0.0,2.1,0.0,2.1,0.0
DISKXFER,T0004,0.0,1.1,0.0,1.1,0.0
</pre></div>
</div>
<p>Using the &#8220;nmon_external_transposed&#8221; will produce the following type of data in Splunk:</p>
<blockquote>
<div>DISKXFER,sys-86391,sys-86391,Linux,60,1440,28-03-2017 14:36:14,sda,2.0
DISKXFER,sys-86391,sys-86391,Linux,60,1440,28-03-2017 14:36:14,sda1,0.0
DISKXFER,sys-86391,sys-86391,Linux,60,1440,28-03-2017 14:36:14,sda2,2.0
DISKXFER,sys-86391,sys-86391,Linux,60,1440,28-03-2017 14:36:14,sdb,0.0
DISKXFER,sys-86391,sys-86391,Linux,60,1440,28-03-2017 14:36:14,sr0,0.0</div></blockquote>
<p>With the following major fields:</p>
<ul class="simple">
<li>type=DISKXFER</li>
<li>host=xxxxxxx</li>
<li>device=xxxxxxx (sda, sda1...)</li>
<li>value=xxxxxxx (with the relevant value for that device, at that time stamp)</li>
</ul>
<p>Which will be much more easy to analyse in Splunk, and allow the management of very large volume of data.</p>
<p>Et voila !</p>
<p><strong>FINAL:</strong></p>
<p>Finally deploy you new configuration to your servers, kill the running nmon processes or wait for their current cycle to end.</p>
<img alt="img/nmon_external_workflow3.png" class="align-center" src="_images/nmon_external_workflow3.png" />
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="nmon_config.html" class="btn btn-neutral float-right" title="Configure your options with nmon.conf" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="upgrade.html" class="btn btn-neutral" title="Upgrade" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Guilhem Marchand.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>