

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Processing workflow in action &mdash; TA-nmon 1.3.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="author" title="About these documents"
              href="about.html"/>
    <link rel="top" title="TA-nmon 1.3.0 documentation" href="index.html"/>
        <link rel="next" title="Deployment" href="deployment.html"/>
        <link rel="prev" title="Deployment Matrix" href="deployment_matrix.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> TA-nmon
          

          
          </a>

          
            
            
              <div class="version">
                1.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">About the TA-nmon, technical addon for Nmon Performance app for Splunk</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasenotes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="knownissues.html">Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="openissue.html">Issues and enhancement requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="os_compatibility.html">Operating Systems compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_overview.html">Introduction to Nmon processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="footprint.html">Benchmarks &amp; TA-nmon foot print</a></li>
<li class="toctree-l1"><a class="reference internal" href="binaries.html">Scripts and Binaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Pre-requisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment_matrix.html">Deployment Matrix</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Processing workflow in action</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#generating-nmon-data">Generating Nmon data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#nmon-helper-sh-tasks-part1-initial-startup-tasks">nmon_helper.sh tasks part1: initial startup tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nmon-helper-sh-tasks-part2-load-values-and-options">nmon_helper.sh tasks part2: load values and options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nmon-helper-sh-tasks-part3-identify-instances">nmon_helper.sh tasks part3: identify instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nmon-helper-sh-tasks-part4-identify-binaries">nmon_helper.sh tasks part4: identify binaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nmon-helper-sh-tasks-part5-startup">nmon_helper.sh tasks part5: startup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#consuming-nmon-data">Consuming Nmon data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parsing-nmon-data">Parsing Nmon data</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade.html">Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="external.html">Extend Nmon with external data</a></li>
<li class="toctree-l1"><a class="reference internal" href="nmon_config.html">Configure your options with nmon.conf</a></li>
<li class="toctree-l1"><a class="reference internal" href="json_indexing.html">JSON indexing versus legacy CSV</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="troubleshoot.html">Troubleshoot</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">TA-nmon</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Processing workflow in action</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/data_processing.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="processing-workflow-in-action">
<h1>Processing workflow in action<a class="headerlink" href="#processing-workflow-in-action" title="Permalink to this headline">¶</a></h1>
<div class="section" id="generating-nmon-data">
<h2>Generating Nmon data<a class="headerlink" href="#generating-nmon-data" title="Permalink to this headline">¶</a></h2>
<p>Generating the Nmon data which basically contains the performance measures and the configuration data is called &#8220;nmon_collect&#8221;.</p>
<p><strong>The activity of the scripts involves in these operations is being logged by Splunk into:</strong></p>
<ul class="simple">
<li>sourcetype=nmon_collect: for standard output</li>
<li>index=_internal sourcetype=splunkd: for stderr (unexpected errors)</li>
</ul>
<p><strong>Most of these operations are done by the main script: bin/nmon_helper.sh:</strong></p>
<div class="section" id="nmon-helper-sh-tasks-part1-initial-startup-tasks">
<h3>nmon_helper.sh tasks part1: initial startup tasks<a class="headerlink" href="#nmon-helper-sh-tasks-part1-initial-startup-tasks" title="Permalink to this headline">¶</a></h3>
<img alt="nmon_helper_part1.png" class="align-center" src="_images/nmon_helper_part1.png" />
<p><strong>Steps are:</strong></p>
<ul class="simple">
<li>basics startup tasks: load SPLUNK_HOME variable, identify the application directories</li>
<li>directory structure: load and verify directory structure, create if required in $SPLUNK_HOME/var/log/nmon</li>
<li>binaries caching: for Linux OS only, verify if cache is existing and up to date, unpack linux.tgz to $SPLUNK_HOME/var/log/nmon if required</li>
<li>start loading default and custom configurations</li>
</ul>
</div>
<div class="section" id="nmon-helper-sh-tasks-part2-load-values-and-options">
<h3>nmon_helper.sh tasks part2: load values and options<a class="headerlink" href="#nmon-helper-sh-tasks-part2-load-values-and-options" title="Permalink to this headline">¶</a></h3>
<img alt="nmon_helper_part2.png" class="align-center" src="_images/nmon_helper_part2.png" />
<p><strong>Steps are:</strong></p>
<ul class="simple">
<li>load hard coded values for nmon options, such as interval and snapshot values</li>
<li>load default/nmon.conf values (source default/nmon.conf)</li>
<li>check if local/nmon.conf exist, and source file (override any previously defined values)</li>
<li>check if /etc/nmon.conf exist (provide override mechanism at local server level), and source file (override any previously defined values)</li>
</ul>
</div>
<div class="section" id="nmon-helper-sh-tasks-part3-identify-instances">
<h3>nmon_helper.sh tasks part3: identify instances<a class="headerlink" href="#nmon-helper-sh-tasks-part3-identify-instances" title="Permalink to this headline">¶</a></h3>
<img alt="nmon_helper_part3.png" class="align-center" src="_images/nmon_helper_part3.png" />
<p><strong>Steps are:</strong></p>
<ul class="simple">
<li>Identify Operating System</li>
<li>Verify PID file existence</li>
<li>Is PID file valid ?</li>
<li>If PID file exists, is the nmon instance running ?</li>
<li>If PID not found, is there an nmon instance running ?</li>
<li>rewrite PID file if nmon is running</li>
<li>trigger nmon startup in other cases</li>
</ul>
</div>
<div class="section" id="nmon-helper-sh-tasks-part4-identify-binaries">
<h3>nmon_helper.sh tasks part4: identify binaries<a class="headerlink" href="#nmon-helper-sh-tasks-part4-identify-binaries" title="Permalink to this headline">¶</a></h3>
<img alt="nmon_helper_part4.png" class="align-center" src="_images/nmon_helper_part4.png" />
<p><strong>Steps are:</strong></p>
<ul class="simple">
<li>Identify Operating System</li>
<li>Identify Processor architecture for Linux / Solaris</li>
<li>Identify local nmon binary for AIX</li>
<li>For Linux, verify embedded binaries priority</li>
<li>For Linux, identify best binary candidate and set nmon binary</li>
<li>For Solaris, set sarmon binary</li>
</ul>
</div>
<div class="section" id="nmon-helper-sh-tasks-part5-startup">
<h3>nmon_helper.sh tasks part5: startup<a class="headerlink" href="#nmon-helper-sh-tasks-part5-startup" title="Permalink to this headline">¶</a></h3>
<img alt="nmon_helper_part5.png" class="align-center" src="_images/nmon_helper_part5.png" />
<p><strong>Steps are:</strong></p>
<ul class="simple">
<li>Idenfity fifo_reader running</li>
<li>set the nmon destination (fifo1 / fifo2)</li>
<li>start nmon binary</li>
<li>Identify interpreter to be used</li>
<li>start the fifo_reader</li>
</ul>
</div>
</div>
<div class="section" id="consuming-nmon-data">
<h2>Consuming Nmon data<a class="headerlink" href="#consuming-nmon-data" title="Permalink to this headline">¶</a></h2>
<p>Consuming the nmon data generated by the nmon_helper.sh and associated scripts (fifo_reader) is in first step operated by the &#8220;bin/fifo_consumer.sh&#8221; script.</p>
<p>This is a very simple shell script that will recompose the nmon data in the correct order, and stream its content to nmon parsers. (nmon2csv)</p>
<p>This script does as well the files rotation, such that next cycle starts such that the nmon_data.dat file is empty after consumption, which guarantees a low level of CPU and resources usage over each iteration.</p>
<img alt="fifo_consumer.png" class="align-center" src="_images/fifo_consumer.png" />
<p><strong>Steps are:</strong></p>
<ul class="simple">
<li>Initialization and configuration loading</li>
<li>Verify if fifo1 and fifo2 have rotated data to be proceeded</li>
<li>Verify if fifo1 and fifo2 have non empty nmon_data.dat</li>
<li>If so, wait at least 5 seconds age file before processing the data</li>
<li>Stream nmon data to nmon2csv.sh</li>
</ul>
</div>
<div class="section" id="parsing-nmon-data">
<h2>Parsing Nmon data<a class="headerlink" href="#parsing-nmon-data" title="Permalink to this headline">¶</a></h2>
<p>This is the final step in the nmon processing tasks, the nmon2csv parsers will consume the data receive in standard input (stdin), and produce final files to be indexed by Splunk.</p>
<p><strong>There 3 scripts involved in these tasks:</strong></p>
<ul class="simple">
<li>bin/nmon2csv.sh: simple shell wrapper that will decide to use Python or Perl parser</li>
<li>bin/nmon2csv.py: the Python version parser</li>
<li>bin/nmon2csv.pl: the Perl version parser</li>
</ul>
<img alt="nmon2csv.png" class="align-center" src="_images/nmon2csv.png" />
<p><strong>Steps are:</strong></p>
<ul class="simple">
<li>nmon2csv.sh reads data from standard input</li>
<li>nmon2csv.sh decides to use Python if version 2.7.x.available, or fall back to Perl</li>
<li>nmon2csv.py|.pl parse the data, generates configuration and performance data, as well as internal flag files</li>
<li>data is being indexed in batch mode by Splunk, index and delete</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="deployment.html" class="btn btn-neutral float-right" title="Deployment" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="deployment_matrix.html" class="btn btn-neutral" title="Deployment Matrix" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Guilhem Marchand.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>